<!DOCTYPE html>
<html>
<head>
  <title>Pending Orders</title>
  <style>
    #dataContainer {
      white-space: pre-wrap;
      font-family: monospace;
      background-color: #f5f5f5;
      padding: 10px;
    }
  </style>
</head>
<body>
  <h1>Pending Orders</h1>

  <button onclick="goBack()">Go Back to View All</button>

  <label for="orderSelect">Select Order ID:</label>
  <select id="orderSelect" onchange="markOrderCompleted()">
    <option value="">Select an Order ID</option>
  </select>

  <button onclick="logout()">Logout</button>

  <div id="dataContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    function goBack() {
      window.location.href = 'viewall.html';
    }

    function logout() {
      localStorage.removeItem('token');
      window.location.href = 'authlogin.html';
    }

    // Retrieve the token from the localStorage
    const token = localStorage.getItem('token');

    // Include the authorization bearer token in the headers of subsequent requests
    axios.get('http://localhost:8000/merchant/pendingorders', {
      headers: {
        'Authorization': 'Bearer ' + token
      }
    })
      .then(response => {
        const data = response.data;

        // Handle the response from the backend
        console.log(data); 

        // Format and display the data in the HTML page
        const dataContainer = document.getElementById('dataContainer');
        dataContainer.textContent = JSON.stringify(data, null, 2);

        // Populate the dropdown with order IDs
        const orderSelect = document.getElementById('orderSelect');
        data.forEach(order => {
          const option = document.createElement('option');
          option.value = order.orderID;
          option.textContent = order.orderID;
          orderSelect.appendChild(option);
        });
      })
      .catch(error => {
        console.error(error); // Replace with your own error handling
      });

    function markOrderCompleted() {
      const orderSelect = document.getElementById('orderSelect');
      const selectedOrderID = orderSelect.value;

      if (selectedOrderID) {
        // Perform a GET request to mark the order as completed
        axios.get(`http://localhost:8000/merchant/completedorder/${selectedOrderID}`, {
          headers: {
            'Authorization': 'Bearer ' + token
          }
        })
          .then(response => {
            console.log(response.data); 
            // Refresh the page to update the pending orders list
            window.location.reload();
          })
          .catch(error => {
            console.error(error); 
          });
      }
    }
  </script>
</body>
</html>
